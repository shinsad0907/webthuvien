<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book.title }} - Shin.vltl</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @media (max-width: 1024px) {
            .book-detail-grid {
                grid-template-columns: 1fr !important;
            }
            .book-cover-section {
                display: grid;
                grid-template-columns: 250px 1fr;
                gap: 20px;
            }
            .book-actions-sidebar {
                grid-column: 1 / -1;
            }
        }
        @media (max-width: 768px) {
            .book-cover-section {
                grid-template-columns: 1fr !important;
            }
            .book-detail-grid {
                gap: 15px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-book"></i>
                    <div>
                        <p style="margin: 0; font-size: 12px; font-weight: 500; opacity: 0.95;">H·ªá th·ªëng th∆∞ vi·ªán ƒëi·ªán t·ª≠</p>
                        <h1 style="margin: 2px 0 0 0;">Shin.vltl</h1>
                        <p style="margin: 0; font-size: 12px; font-weight: 500; opacity: 0.95;">Tr∆∞·ªùng Ti·ªÉu h·ªçc L√™ VƒÉn T√°m</p>
                    </div>
                </div>
                <div class="search-bar">
                    <form>
                        <input type="text" class="search-input" placeholder="B·∫°n mu·ªën t√¨m g√¨?">
                        <button type="submit" class="search-btn">T√¨m ki·∫øm</button>
                    </form>
                </div>
                {% if session.user_card_id %}
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="color: white; font-size: 13px;">üëã {{ session.user_name }}</span>
                    <a href="/profile" style="color: white; text-decoration: none; padding: 8px 12px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 13px;">
                        <i class="fas fa-user-circle"></i>
                    </a>
                    <a href="/logout" style="color: white; text-decoration: none; padding: 8px 12px; background: #e74c3c; border-radius: 20px; font-size: 13px;">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
                {% else %}
                <a href="/login?next=/book/{{ book.id }}" class="btn-login"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <ul class="nav-menu">
                <li><a href="/"><i class="fas fa-home"></i> TRANG CH·ª¶</a></li>
                <li><a href="/favorites"><i class="fas fa-heart"></i> Y√äU TH√çCH</a></li>
            </ul>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="container" style="padding: 15px 0;">
        <a href="/" style="color: #2c7873; text-decoration: none; font-size: 13px;">
            <i class="fas fa-arrow-left"></i> Quay l·∫°i
        </a>
    </div>

    <!-- Main Content -->
    <div class="container" style="margin-bottom: 50px;">
        <div class="book-detail-grid" style="display: grid; grid-template-columns: 250px 1fr 300px; gap: 25px;">
            
            <!-- LEFT COLUMN: Cover & Actions -->
            <div class="book-cover-section">
                <!-- Book Cover -->
                <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                    <img src="{{ url_for('static', filename='images/' + (book.cover|cover)) }}" 
                        alt="{{ book.title }}"
                        loading="lazy" style="width: 100%; height: auto; display: block;">
                </div>

                <!-- Action Buttons -->
                <div>
                    {% if session.user_card_id %}
                    <div style="background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); display: flex; flex-direction: column; gap: 8px;">
                        
                        <!-- Favorite Button -->
                        <button onclick="toggleFavorite({{ book.id }})" 
                                style="width: 100%; padding: 10px; border: 2px solid #e74c3c; background: {% if is_favorite %}#e74c3c{% else %}white{% endif %}; color: {% if is_favorite %}white{% else %}#e74c3c{% endif %}; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s;">
                            <i class="{% if is_favorite %}fas{% else %}far{% endif %} fa-heart"></i> Y√™u th√≠ch
                        </button>

                        <!-- Read Online Button -->
                        <button onclick="openPdfViewer({{ book.id }})" 
                                style="width: 100%; padding: 10px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                            <i class="fas fa-book-open"></i> ƒê·ªçc online
                        </button>

                        <!-- Download Button -->
                        <button onclick="downloadBook({{ book.id }})" 
                                style="width: 100%; padding: 10px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                            <i class="fas fa-download"></i> T·∫£i PDF
                        </button>
                    </div>
                    {% else %}
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 8px; text-align: center;">
                        <p style="color: #856404; margin: 0 0 10px 0; font-weight: 600; font-size: 13px;">
                            <i class="fas fa-lock"></i> ƒêƒÉng nh·∫≠p
                        </p>
                        <a href="/login?next=/book/{{ book.id }}" style="display: inline-block; padding: 8px 16px; background: #ffc107; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 12px;">
                            ƒêƒÉng nh·∫≠p ngay
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- CENTER COLUMN: Book Info -->
            <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                
                <!-- Title & Author -->
                <h1 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 24px;">{{ book.title }}</h1>
                <p style="color: #7f8c8d; font-size: 13px; margin: 0 0 15px 0;">
                    <i class="fas fa-user"></i> {{ book.author }}
                </p>

                <!-- Rating -->
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #ecf0f1;">
                    <div style="color: #f39c12; font-size: 14px;">
                        {% for i in range(int(book.rating)) %}
                        <i class="fas fa-star"></i>
                        {% endfor %}
                    </div>
                    <span style="color: #7f8c8d; font-size: 12px;">
                        <strong>{{ book.rating }}</strong> / 5.0
                    </span>
                </div>

                <!-- Stats -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <div style="background: #f0f4f8; padding: 12px; border-radius: 8px; text-align: center;">
                        <p style="font-size: 18px; font-weight: 700; color: #2c7873; margin: 0;">{{ book.views }}</p>
                        <p style="color: #7f8c8d; font-size: 11px; margin-top: 4px; margin-bottom: 0;">
                            <i class="fas fa-eye"></i> L∆∞·ª£t xem
                        </p>
                    </div>
                    <div style="background: #f0f4f8; padding: 12px; border-radius: 8px; text-align: center;">
                        <p style="font-size: 18px; font-weight: 700; color: #2c7873; margin: 0;">{{ book.downloads }}</p>
                        <p style="color: #7f8c8d; font-size: 11px; margin-top: 4px; margin-bottom: 0;">
                            <i class="fas fa-download"></i> T·∫£i v·ªÅ
                        </p>
                    </div>
                    <div style="background: #f0f4f8; padding: 12px; border-radius: 8px; text-align: center;">
                        <p style="font-size: 18px; font-weight: 700; color: #2c7873; margin: 0;">{{ book.available_copies }}/{{ book.total_copies }}</p>
                        <p style="color: #7f8c8d; font-size: 11px; margin-top: 4px; margin-bottom: 0;">
                            <i class="fas fa-book"></i> C√≤n
                        </p>
                    </div>
                </div>

                <!-- Description -->
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #ecf0f1;">
                    <h4 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 13px; font-weight: 600;">
                        <i class="fas fa-info-circle"></i> Gi·ªõi thi·ªáu
                    </h4>
                    <p style="color: #34495e; line-height: 1.6; margin: 0; font-size: 13px;">{{ book.description }}</p>
                </div>

                <!-- Details Table -->
                <div>
                    <h4 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 13px; font-weight: 600;">
                        <i class="fas fa-list"></i> Th√¥ng tin
                    </h4>
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 8px 0; color: #7f8c8d; font-weight: 600; width: 35%;">Th·ªÉ lo·∫°i</td>
                            <td style="padding: 8px 0; color: #34495e;">{{ book.category }}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 8px 0; color: #7f8c8d; font-weight: 600;">Lo·∫°i s√°ch</td>
                            <td style="padding: 8px 0; color: #34495e;">
                                <span style="background: #e8f5e9; color: #27ae60; padding: 3px 6px; border-radius: 4px; font-size: 11px;">
                                    {{ book.book_type }}
                                </span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 8px 0; color: #7f8c8d; font-weight: 600;">NXB</td>
                            <td style="padding: 8px 0; color: #34495e;">{{ book.publisher }}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #ecf0f1;">
                            <td style="padding: 8px 0; color: #7f8c8d; font-weight: 600;">NƒÉm</td>
                            <td style="padding: 8px 0; color: #34495e;">{{ book.year }}</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px 0; color: #7f8c8d; font-weight: 600;">S·ªë trang</td>
                            <td style="padding: 8px 0; color: #34495e;">{{ book.pages }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- RIGHT COLUMN: Sidebar -->
            <div class="book-actions-sidebar" style="display: flex; flex-direction: column; gap: 15px;">
                
                <!-- Status -->
                <div style="background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                    <h4 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 13px; font-weight: 600;">
                        <i class="fas fa-info-circle" style="color: #2c7873;"></i> T√¨nh tr·∫°ng
                    </h4>
                    
                    {% if book.available_copies > 0 %}
                    <div style="background: #d5f4e6; padding: 10px; border-radius: 6px; border-left: 3px solid #27ae60;">
                        <p style="color: #27ae60; font-weight: 600; margin: 0; font-size: 12px;">
                            <i class="fas fa-check-circle"></i> C√≤n s√°ch
                        </p>
                    </div>
                    <p style="color: #7f8c8d; font-size: 11px; margin: 8px 0 0 0;">
                        C√≤n <strong style="color: #27ae60;">{{ book.available_copies }}</strong> / {{ book.total_copies }}
                    </p>
                    {% else %}
                    <div style="background: #fadbd8; padding: 10px; border-radius: 6px; border-left: 3px solid #e74c3c;">
                        <p style="color: #c0392b; font-weight: 600; margin: 0; font-size: 12px;">
                            <i class="fas fa-times-circle"></i> H·∫øt s√°ch
                        </p>
                    </div>
                    {% endif %}
                </div>

                <!-- Borrowers -->
                {% if book.borrowers|length > 0 %}
                <div style="background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                    <h4 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 13px; font-weight: 600;">
                        <i class="fas fa-users"></i> Ng∆∞·ªùi ƒëang m∆∞·ª£n ({{ book.borrowers|length }})
                    </h4>
                    
                    <div style="display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto;">
                        {% for borrower in book.borrowers[:5] %}
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; border-left: 2px solid #3498db; font-size: 11px;">
                            <p style="font-weight: 600; color: #2c3e50; margin: 0 0 3px 0;">
                                {{ borrower.user }}
                            </p>
                            <p style="color: #7f8c8d; margin: 0;">
                                <i class="fas fa-calendar"></i> {{ borrower.borrow_date }}
                            </p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Links -->
                <div style="background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                    <h4 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 13px; font-weight: 600;">
                        <i class="fas fa-link"></i> Li√™n k·∫øt
                    </h4>
                    <div style="display: flex; flex-direction: column; gap: 6px;">
                        <a href="/category/{{ book.category }}" 
                           style="padding: 8px; background: #ecf5f9; color: #3498db; text-decoration: none; border-radius: 6px; font-size: 11px; text-align: center; font-weight: 600;">
                            <i class="fas fa-folder"></i> C√πng th·ªÉ lo·∫°i
                        </a>
                        <a href="/search?q={{ book.author }}" 
                           style="padding: 8px; background: #f0f5f9; color: #3498db; text-decoration: none; border-radius: 6px; font-size: 11px; text-align: center; font-weight: 600;">
                            <i class="fas fa-pen"></i> T√°c gi·∫£ kh√°c
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p style="margin: 0;">
                <strong>Shin.vltl - H·ªá th·ªëng th∆∞ vi·ªán ƒëi·ªán t·ª≠</strong><br>
                Tr∆∞·ªùng Ti·ªÉu h·ªçc L√™ VƒÉn T√°m
            </p>
            <p style="margin: 5px 0 0 0; font-size: 12px;">&copy; 2024 - B·∫£o l∆∞u m·ªçi quy·ªÅn</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>